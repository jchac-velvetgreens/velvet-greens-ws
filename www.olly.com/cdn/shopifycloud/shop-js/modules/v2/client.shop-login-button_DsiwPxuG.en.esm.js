import{J as e,_ as o,u as t,R as n,r as i,v as s,g as r,h as a,s as l,A as c,k as u,K as p,L as d,y as h,T as g,M as m,N as f,q as S,E as v,O as _,Q as w,U as x,V as y,W as I,i as b,X as C,Y as T,Z as W,n as k,o as O,$ as N,b as M,a0 as P}from"./chunk.common_BHYMFzo0.esm.js";import{A as U}from"./chunk.modal_C7-_mGwj.esm.js";const A={loginWithShop:"default",loginWithShopSelfServe:"self_serve_customer_accounts",loginWithShopClassicCustomerAccounts:"classic_customer_accounts",loginWithShopPrequal:"shop_pay_installments_prequal",loginWithShopPaymentRequest:"payment_request",loginWithShopCheckoutExtension:"default",loginWithShopCheckoutModal:"checkout_modal",loginWithShopShopWeb:"",shopCashOffers:"shop_cash_offers"};function B({analyticsContext:e="loginWithShop",checkoutToken:o,checkoutVersion:t,flowVersion:n,shopId:i,source:s,uxMode:r}){return{analyticsContext:e,checkoutVersion:t,checkoutToken:o,flow:A[e],flowVersion:n,shopId:i,source:s,uxMode:r}}const L=["loginWithShop"],q=e=>{var{action:n,activatorId:A,analyticsContext:B="loginWithShop",anchorTo:q,autoOpen:R,email:V,emailInputSelector:E,experiments:j,firstname:H,fullWidth:G,hideButton:K,lastname:z,persistAfterSignIn:D=!0,proxy:$=!1,uxMode:F="iframe",version:J}=e,Q=o(e,["action","activatorId","analyticsContext","anchorTo","autoOpen","email","emailInputSelector","experiments","firstname","fullWidth","hideButton","lastname","persistAfterSignIn","proxy","uxMode","version"]);const{notify:X}=i(),{trackPageImpression:Y,trackUserAction:Z}=s(),{translate:ee}=r(),[oe,te]=a(!0),ne=l(),ie=c(A?u.getElementById(A):null),se=c(null),re=c(null),ae=c(null),[le,ce]=a(),ue=p({experiments:j,defaultUxMode:"redirect",uxMode:F}),{getSubmittedEmail:pe,updateEmailToPost:de,updateNamesToPost:he}=d({autoOpen:R,email:V,emailInputSelector:E,iframeRef:re});h((()=>{he(H,z)}),[H,z,he]);const ge=g((()=>{const e=e=>v(void 0,[e],void 0,(function*({detail:e}){ce(void 0);const o=e.email;yield de(o)}));return{requestShow:e,start:e}}),[de]);m(ge),h((()=>{var e,o;n&&("follow"===n?null===(e=console.warn)||void 0===e||e.call(console,"[Sign in with Shop] The action prop is deprecated, please use <shop-follow-button> instead."):null===(o=console.warn)||void 0===o||o.call(console,`[Sign in with Shop] Received deprecated attribute: action, "${n}"`))}),[n,X]),h((()=>{K||Y({page:"SIGN_IN_WITH_SHOP_BUTTON"})}),[K,Y]);const me=f({storefrontOrigin:Q.storefrontOrigin}),fe=S((e=>v(void 0,void 0,void 0,(function*(){const{email:o,givenName:t,userInteracted:n}=e;let i;D||te(!1),n||(i=ee("shopLoginButton.toast.action"));let s=ee("shopLoginButton.toast.default");t&&(s=ee("shopLoginButton.toast.user",{user:t}));const r={actionText:i,subText:o,text:s};L.includes(B)?_(r):"windoid"===ue&&w(x,r),yield me(e)}))),[ue,B,D,ee,me]),Se="loginWithShopPrequal"===B?{disableSignUp:!1,flow:"prequal",flowVersion:"unspecified",hideCopy:!1,isCompactLayout:!1,proxy:!0}:{},ve=g((()=>{var e;return void 0!==J&&(null===(e=console.warn)||void 0===e||e.call(console,`[Sign in with Shop] Received deprecated attribute: version, "${J}"`)),$||"2"===J}),[$,J]),{authorizeUrl:_e,getAuthorizeUrl:we}=y(Object.assign(Object.assign(Object.assign({analyticsContext:B,error:le,experiments:j},Q),{proxy:ve,uxMode:ue}),Se));const xe=I({windoidRef:ae,handleComplete:fe}),ye=S((e=>{switch(ue){case"windoid":ae.current=C(e,xe);break;case"redirect":b.location.href=e}}),[ue,xe]),Ie=S((()=>{Z({userAction:"SIGN_IN_WITH_SHOP_BUTTON_CLICK"}),ye(_e)}),[_e,ye,Z]),be=T(Ie,150,!0),Ce=S((()=>{var e;Z({userAction:"SIGN_IN_WITH_SHOP_PROMPT_CHANGE_CLICK"}),null===(e=null==re?void 0:re.current)||void 0===e||e.close({dismissMethod:"prompt_change",reason:"user_prompt_change_clicked"})}),[Z]),Te=W({getAuthorizeUrl:we,getEmail:pe,iframeRef:re,openWindoid:ye}),We=K||ie.current||!oe?null:t(N,{onClick:be,ref:se,className:k("m-auto",G?"w-full justify-center":void 0),children:t("span",{className:"cursor-pointer whitespace-nowrap px-11 py-4 font-sans text-button-large text-white",children:ee("shopLoginButton.continue",{shop:t(O,{className:"relative inline-block h-4 w-auto"})})})}),ke="iframe"===ue,Oe=ie.current?ie:se,Ne=ke?Oe:void 0,Me=g((()=>ke?_e:we({uxRole:"prompt"})),[_e,we,ke]),Pe=ke||P()?"default":"wide";return t(M,{children:[We,t(U,{activator:Ne,anchorTo:q,autoOpen:R&&!ae.current,onComplete:fe,onError:function({code:e,email:o,message:t}){var n;ne("error",{code:e,email:o,message:t}),"retriable_server_error"===e&&(le===e&&(null===(n=re.current)||void 0===n||n.reload()),ce(e))},onPromptChange:Ce,onPromptContinue:Te,proxy:ve,ref:re,src:Me,modalType:Pe,variant:"default"})]})},R=e=>v(void 0,void 0,void 0,(function*(){return{shopLoginButton:{title:"Sign in with Shop",continue:"Sign in with {shop}",toast:{default:"Signed in with Shop",user:"Signed in as {user}",action:"Switch"}}}}));e((e=>{var{element:i}=e,s=o(e,["element"]);return t(n,{element:i,featureName:"ShopLoginButton",getFeatureDictionary:R,monorailProps:B(s),children:t(q,Object.assign({},s))})}),{methods:["requestShow","start","showToast"],name:"shop-login-button",props:{action:"string",activatorId:"string",analyticsContext:"string",anchorTo:"string",apiKey:"string",autoOpen:"boolean",avoidPayAltDomain:"boolean",checkoutVersion:"string",clientId:"string",codeChallenge:"string",codeChallengeMethod:"string",consentChallenge:"string",disableSignUp:"boolean",email:"string",emailInputSelector:"string",experiments:"string",firstname:"string",flow:"string",flowVersion:"string",fullWidth:"boolean",hideButton:"boolean",keepModalOpen:"boolean",lastname:"string",persistAfterSignIn:"boolean",popUpFeatures:"string",popUpName:"string",proxy:"boolean",redirectType:"string",redirectUri:"string",requireVerification:"boolean",responseMode:"string",responseType:"string",returnUri:"string",scope:"string",source:"string",state:"string",storefrontDomain:"string",uxMode:"string",version:"string"},shadow:"open"});
//# sourceMappingURL=client.shop-login-button_DsiwPxuG.en.esm.js.map
