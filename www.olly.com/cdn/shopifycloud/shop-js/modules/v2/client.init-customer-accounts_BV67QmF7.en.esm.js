import"./client.shop-login-button_DsiwPxuG.en.esm.js";import{E as e,a3 as t,a6 as n,i as o,ac as i,an as s,G as a,k as r,ai as c,aj as l,ak as u,ao as d,ap as p,aq as m,al as f,af as g,ag as h,ar as v,a4 as _}from"./chunk.common_BHYMFzo0.esm.js";import"./chunk.modal_C7-_mGwj.esm.js";function y(){return e(this,arguments,void 0,(function*(_=!1,y){var E,w;const k=t(),j=new n("initCustomerAccounts"),A={analyticsContext:"loginWithShopClassicCustomerAccounts",analyticsTraceId:k,apiKey:"",flow:"classic_customer_accounts",flowVersion:"sign_in",shopPermanentDomain:null!==(w=null===(E=o.Shopify)||void 0===E?void 0:E.shop)&&void 0!==w?w:""},I=new i({analyticsData:A,notify:j.notify});try{if(s(o.location.pathname).endsWith("/account"))return void function(){e(this,void 0,void 0,(function*(){I.trackPageImpression({page:"CLASSIC_CUSTOMER_ACCOUNTS_ACCOUNT_PAGE"}),yield import("./loader.shop-toast-manager.en.esm.js")}))}();_&&function(){const e=r.querySelector("#customer_login");if(!e)return;c({mediation:"required",analyticsTraceId:k,monorailTracker:I}).then((t=>function(e,t,n,i){if(200!==(null==e?void 0:e.status))return void(null==i||i.notify(new Error("FedCM failed to authenticate")));if(!t)return void(null==i||i.notify(new Error("FedCM failed to find the nearest form to leverage sign in URL")));const s=O(t,n);o.location.assign(s)}(t,e,k,j))).catch((e=>function(e,t){if(e instanceof d||e instanceof p||"IdentityCredentialError"===e.name&&"Error retrieving a token."===e.message||e instanceof DOMException&&"NetworkError"===e.name&&"Error retrieving a token."===e.message)return;t.notify(e)}(e,j)))}(),function({autoOpen:e,initOptions:t}){const n=new WeakMap;let i=null;const s=l({onFallback:e=>{e.addEventListener("focus",a,{once:!0}),I.produceMonorailEvent({event:{schemaId:"shopify_pay_login_with_shop_sdk_error_events/1.0",payload:Object.assign(Object.assign({},A),{sdkVersion:"1.0.32-beta",errorCode:"fallback_to_focus_event",errorMessage:"Fallback to focus event for classic customer accounts"})}})},onVisible:t=>c({input:t,autoOpen:e})});function a(t){c({input:t.target,autoOpen:e})}function c({input:e,autoOpen:s}){var a;const c=e.form;if(!c)return void j.notify(new Error("Email form missing for classic customer accounts"));if(n.has(e)&&(j.notify(new Error("Input listener already exists for input")),null===(a=n.get(e))||void 0===a||a.destroy(),n.delete(e)),!i){i=function({autoOpen:e,initOptions:t}){let n,o=!1;n=r.querySelector("shop-login-button:not([action])"),n||(n=g("shop-login-button"),o=!0);const i=null==t?void 0:t.windoidEnabled;(function({element:e,props:t}){Object.entries(Object.assign(Object.assign({},b),t)).forEach((([t,n])=>{const o=v(t);e.setAttribute(o,String(n))}))})({element:n,props:Object.assign(Object.assign(Object.assign(Object.assign({autoOpen:e,consentChallenge:!0,disableSignUp:!0,experiments:JSON.stringify((null==t?void 0:t.experiments)||{})},o?{hideButton:!0}:{}),{proxy:!0}),h()),i&&{responseType:"code",uxMode:"windoid"})}),o&&r.body.appendChild(n);return n}({autoOpen:s,initOptions:t});const e=O(c,C(i));i.setAttribute("return-uri",e),i.addEventListener("completed",(()=>{o.location.assign(e)})),i.addEventListener("modalclosed",(()=>{m("signInWithShop:modalDismissed","true")}))}i.getAttribute("defer-modal-on-autofill")&&i.setAttribute("email-input-selector",`#${e.id}`),i.setAttribute("email",e.value),n.set(e,new f(e,(e=>{null==i||i.setAttribute("email",e)})));const l=r.createElement("input");l.type="hidden",l.name="login_with_shop[analytics_trace_id]",l.value=C(i),c.appendChild(l)}u({onElementFound:e=>s.observe(e),selector:'form[data-login-with-shop-sign-in] input[type="email"],form[data-login-with-shop-sign-in] input[name="customer[email]"'})}({autoOpen:!_,initOptions:y})}catch(e){e instanceof Error&&j.notify(e),e instanceof a&&"InitCustomerAccountsError"===e.name&&I.produceMonorailEvent({event:{payload:Object.assign(Object.assign({},A),{analyticsTraceId:e.analyticsTraceId||k,errorCode:e.code,errorMessage:e.message,sdkVersion:"1.0.32-beta"}),schemaId:"shopify_pay_login_with_shop_sdk_error_events/1.0"}})}}))}const b={analyticsContext:"loginWithShopClassicCustomerAccounts",clientId:"",flow:"classic_customer_accounts",flowVersion:"sign_in"};function O(e,t){var n,i;const s=null===(n=e.elements.namedItem("checkout_url"))||void 0===n?void 0:n.value,a=null===(i=e.elements.namedItem("return_url"))||void 0===i?void 0:i.value,r=new URLSearchParams(Object.assign(Object.assign({analytics_trace_id:t},s&&{checkout_url:s}),a&&{return_url:a}));return`${o.location.origin}/account/redirect?${r.toString()}`}function C(e){return(null==e?void 0:e.getAttribute("data-instance-id"))||t()}_("initCustomerAccounts",y);
//# sourceMappingURL=client.init-customer-accounts_BV67QmF7.en.esm.js.map
